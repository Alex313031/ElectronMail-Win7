From e60061699263562564c81a4e4db08d39b3260504 Mon Sep 17 00:00:00 2001
From: "Vladimir.Y" <1560781+vladimiry@users.noreply.github.com>
Date: Wed, 25 May 2022 13:59:20 +0300
Subject: [PATCH] wip

---
 packages/shared/lib/helpers/sentry.ts | 99 +--------------------------
 1 file changed, 3 insertions(+), 96 deletions(-)

diff --git a/packages/shared/lib/helpers/sentry.ts b/packages/shared/lib/helpers/sentry.ts
index 2ffbe86fa..af09bb1b8 100644
--- a/packages/shared/lib/helpers/sentry.ts
+++ b/packages/shared/lib/helpers/sentry.ts
@@ -65,103 +65,10 @@ interface Arguments {
     uid?: string;
 }

-function main({ config: { SENTRY_DSN, COMMIT, APP_VERSION }, uid, sessionTracking = false }: Arguments) {
-    const { host } = window.location;
+function main({ config: { SENTRY_DSN, COMMIT, APP_VERSION }, uid, sessionTracking = false }: Arguments) {}

-    // No need to configure it if we don't load the DSN
-    if (!SENTRY_DSN || isLocalhost(host)) {
-        return;
-    }
-
-    setUID(uid);
-
-    // Assumes SENTRY_DSN is: https://111b3eeaaec34cae8e812df705690a36@sentry/11
-    // To get https://111b3eeaaec34cae8e812df705690a36@protonmail.com/api/core/v4/reports/sentry/11
-    const dsn = SENTRY_DSN.replace('sentry', `${host}/api/core/v4/reports/sentry`);
-
-    Sentry.init({
-        dsn,
-        release: isProduction(host) ? APP_VERSION : COMMIT,
-        environment: host.split('.').splice(1).join('.'),
-        normalizeDepth: 5,
-        transport: Transport,
-        autoSessionTracking: sessionTracking,
-        // Disable client reports. Client reports are used by sentry to retry events that failed to send on visibility change.
-        // Unfortunately Sentry does not use the custom transport for those, and thus fails to add the headers the API requires.
-        sendClientReports: false,
-        beforeSend(event, hint) {
-            const error = hint?.originalException;
-            const stack = typeof error === 'string' ? error : error?.stack;
-            // Filter out broken ferdi errors
-            if (stack && stack.match(/ferdi|franz/i)) {
-                return null;
-            }
-
-            // Not interested in uncaught API errors
-            if (error instanceof ApiError) {
-                return null;
-            }
-
-            // Remove the hash from the request URL and navigation breadcrumbs to avoid
-            // leaking the search parameters of encrypted searches
-            if (event.request && event.request.url) {
-                [event.request.url] = event.request.url.split('#');
-            }
-            if (event.breadcrumbs) {
-                event.breadcrumbs = event.breadcrumbs.map((breadcrumb) => {
-                    if (breadcrumb.category === 'navigation' && breadcrumb.data) {
-                        [breadcrumb.data.from] = breadcrumb.data.from.split('#');
-                        [breadcrumb.data.to] = breadcrumb.data.to.split('#');
-                    }
-                    return breadcrumb;
-                });
-            }
-
-            return event;
-        },
-        ignoreErrors: [
-            // Ignore random plugins/extensions
-            'top.GLOBALS',
-            'canvas.contentDocument',
-            'MyApp_RemoveAllHighlights',
-            'atomicFindClose',
-            'conduitPage',
-            // https://bugzilla.mozilla.org/show_bug.cgi?id=1678243
-            'XDR encoding failure',
-            'Request timed out',
-            'No network connection',
-            'Failed to fetch',
-            'NetworkError when attempting to fetch resource.',
-            'No network connection',
-            'webkitExitFullScreen', // Bug in Firefox for iOS.
-            'InactiveSession',
-            'UnhandledRejection', // Happens too often in extensions and we have lints for that, so should be safe to ignore.
-            /chrome-extension/,
-            /moz-extension/,
-            'TransferCancel', // User action to interrupt upload or download in Drive.
-            'UploadConflictError', // User uploading the same file again in Drive.
-            'UploadUserError', // Upload error on user's side in Drive.
-            'ValidationError', // Validation error on user's side in Drive.
-            'ChunkLoadError', // WebPack loading source code.
-            /ResizeObserver loop/, // Chromium bug https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded
-        ],
-    });
+export const traceError = (...args: Parameters<typeof Sentry.captureException>) => console.error(...args);

-    Sentry.configureScope((scope) => {
-        scope.setTag('appVersion', APP_VERSION);
-    });
-}
-
-export const traceError = (...args: Parameters<typeof Sentry.captureException>) => {
-    if (!isLocalhost(window.location.host)) {
-        Sentry.captureException(...args);
-    }
-};
-
-export const captureMessage = (...args: Parameters<typeof Sentry.captureMessage>) => {
-    if (!isLocalhost(window.location.host)) {
-        Sentry.captureMessage(...args);
-    }
-};
+export const captureMessage = (...args: Parameters<typeof Sentry.captureMessage>) => console.log(...args);

 export default main;
